<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Раздел 4: Отчеты и запросы - Учебный курс</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        
        .code-keyword {
            color: #3498db;
            font-weight: bold;
        }
        
        .code-string {
            color: #2ecc71;
        }
        
        .code-comment {
            color: #95a5a6;
            font-style: italic;
        }
        
        .code-number {
            color: #e74c3c;
        }
        
        .exercise-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            border-left: 4px solid #9b59b6;
        }
        
        .exercise-list h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .exercise-list ol {
            padding-left: 20px;
        }
        
        .exercise-list li {
            margin-bottom: 10px;
            padding-left: 10px;
        }
        
        .info-box {
            background: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .sdk-architecture {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }
        
        .sdk-layers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .sdk-layer {
            background: #f5f7fa;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            border-top: 3px solid #3498db;
        }
        
        .sdk-layer h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sdk-layer ul {
            margin-left: 20px;
            color: #34495e;
        }
        
        .sdk-layer li {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .query-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .query-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border-left: 3px solid #2ecc71;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .query-card h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .query-snippet {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .comparison-table th, .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1><i class="fas fa-chart-bar"></i> Раздел 4: Отчеты, СКД и запросы</h1>
            <p>Система компоновки данных, язык запросов, построение отчетов</p>
        </div>
    </header>

    <main class="container">
        <a href="../index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> Назад к разделам
        </a>

        <div class="lecture-container">
            <h1 class="lecture-title">Отчеты, система компоновки данных и запросы</h1>
            
            <div class="lecture-content">
                <h3>1. Система компоновки данных (СКД)</h3>
                <p>СКД — это универсальный механизм платформы 1С для построения сложных отчетов и обработок данных. Она позволяет создавать отчеты без программирования, используя визуальный конструктор, что значительно ускоряет разработку.</p>
                
                <div class="sdk-architecture">
                    <h4>Архитектура системы компоновки данных</h4>
                    <div class="sdk-layers">
                        <div class="sdk-layer">
                            <h5><i class="fas fa-database"></i> Источники данных</h5>
                            <ul>
                                <li>Запросы на языке 1С</li>
                                <li>Объекты метаданных</li>
                                <li>Внешние источники</li>
                                <li>Таблицы значений</li>
                            </ul>
                        </div>
                        
                        <div class="sdk-layer">
                            <h5><i class="fas fa-filter"></i> Обработка данных</h5>
                            <ul>
                                <li>Фильтрация и отбор</li>
                                <li>Группировка и сортировка</li>
                                <li>Вычисляемые поля</li>
                                <li>Итоги и подытоги</li>
                            </ul>
                        </div>
                        
                        <div class="sdk-layer">
                            <h5><i class="fas fa-file-export"></i> Вывод данных</h5>
                            <ul>
                                <li>Табличные документы</li>
                                <li>Диаграммы и графики</li>
                                <li>Экспорт в Excel/PDF</li>
                                <li>Веб-отчеты</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h3>2. Язык запросов 1С</h3>
                <p>Язык запросов 1С — это SQL-подобный язык для работы с данными, оптимизированный для объектов метаданных платформы. Он позволяет получать данные из справочников, документов и регистров с учетом всех бизнес-правил.</p>
                
                <div class="query-examples">
                    <div class="query-card">
                        <h5>Базовый запрос</h5>
                        <div class="query-snippet">
                            ВЫБРАТЬ<br>
                            &nbsp;&nbsp;Номенклатура.Наименование,<br>
                            &nbsp;&nbsp;СУММА(Продажи.Количество) КАК Продано<br>
                            ИЗ РегистрНакопления.Продажи КАК Продажи<br>
                            СГРУППИРОВАТЬ ПО Номенклатура.Наименование
                        </div>
                    </div>
                    
                    <div class="query-card">
                        <h5>Запрос с параметрами</h5>
                        <div class="query-snippet">
                            ВЫБРАТЬ<br>
                            &nbsp;&nbsp;Документ.Дата,<br>
                            &nbsp;&nbsp;Документ.Сумма<br>
                            ИЗ Документ.РеализацияТоваров КАК Документ<br>
                            ГДЕ Документ.Дата МЕЖДУ &НачалоПериода<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;И &КонецПериода
                        </div>
                    </div>
                    
                    <div class="query-card">
                        <h5>Сложный запрос с объединением</h5>
                        <div class="query-snippet">
                            ВЫБРАТЬ Приход.Номенклатура,<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;Приход.Количество КАК Приход<br>
                            ОБЪЕДИНИТЬ ВСЕ<br>
                            ВЫБРАТЬ Расход.Номенклатура,<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;Расход.Количество КАК Расход<br>
                            ИЗ РегистрНакопления.Расходы КАК Расход
                        </div>
                    </div>
                </div>
                
                <h3>3. Основные объекты СКД</h3>
                <p>СКД использует набор объектов для определения структуры отчета:</p>
                <ul>
                    <li><strong>Схема компоновки данных:</strong> Определяет источники данных, поля, параметры и настройки</li>
                    <li><strong>Настройки компоновки:</strong> Задают визуальное представление (группировки, сортировки, отборы)</li>
                    <li><strong>Макет компоновки:</strong> Описывает внешний вид отчета (шапка, подвал, детальные записи)</li>
                    <li><strong>Компоновщик настроек:</strong> Позволяет пользователям настраивать отчеты во время выполнения</li>
                </ul>
                
                <h3>4. Управляемое vs обычное приложение</h3>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Аспект</th>
                            <th>Обычное приложение</th>
                            <th>Управляемое приложение</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Формы запросов</td>
                            <td>Создаются программно в коде</td>
                            <td>Определяются в метаданных, генерируются автоматически</td>
                        </tr>
                        <tr>
                            <td>Доступ к данным</td>
                            <td>Прямой доступ через объекты метаданных</td>
                            <td>Доступ через менеджеры объектов и реквизиты</td>
                        </tr>
                        <tr>
                            <td>Обработка событий</td>
                            <td>В модулях форм и объектов</td>
                            <td>В модулях команд и форм с разделением на клиент/сервер</td>
                        </tr>
                        <tr>
                            <td>Отчеты СКД</td>
                            <td>Поддерживаются с дополнительными настройками</td>
                            <td>Полная поддержка, интегрированы в интерфейс</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="info-box">
                    <p><strong>Ключевое преимущество СКД:</strong> Возможность создания сложных отчетов без программирования, с настройкой параметров пользователями и поддержкой различных форматов вывода.</p>
                </div>
                
                <!-- Контрольные вопросы -->
                <div class="questions-section">
                    <h2 class="questions-title">Контрольные вопросы</h2>
                    
                    <div class="question-item">
                        <h4>Вопрос 1: Что такое система компоновки данных (СКД) и каковы её преимущества?</h4>
                        <button class="answer-btn">Показать ответ</button>
                        <div class="answer">
                            СКД — это универсальный механизм платформы 1С для построения отчетов, позволяющий создавать сложные отчеты без программирования через визуальный конструктор; её преимущества включают гибкость настройки, поддержку различных форматов вывода и возможность пользовательской кастомизации.
                        </div>
                    </div>
                    
                    <div class="question-item">
                        <h4>Вопрос 2: Как построить простой запрос на языке запросов 1С?</h4>
                        <button class="answer-btn">Показать ответ</button>
                        <div class="answer">
                            Простой запрос строится с использованием конструкции "ВЫБРАТЬ...ИЗ...ГДЕ", где указываются выбираемые поля, источник данных (справочник, документ или регистр) и условия отбора; запрос может включать группировки, сортировку и вычисляемые поля.
                        </div>
                    </div>
                    
                    <div class="question-item">
                        <h4>Вопрос 3: Какие основные объекты используются в СКД?</h4>
                        <button class="answer-btn">Показать ответ</button>
                        <div class="answer">
                            Основные объекты СКД включают схему компоновки данных (определяет источники и структуру), настройки компоновки (задают представление), макет компоновки (описывает внешний вид) и компоновщик настроек (позволяет пользователям настраивать отчет).
                        </div>
                    </div>
                    
                    <div class="question-item">
                        <h4>Вопрос 4: Как настроить варианты отчета в СКД?</h4>
                        <button class="answer-btn">Показать ответ</button>
                        <div class="answer">
                            Варианты отчета настраиваются через компоновщик настроек, где можно создавать предопределенные варианты с разными отборами, группировками и сортировками; пользователи могут сохранять свои варианты настроек для быстрого доступа.
                        </div>
                    </div>
                    
                    <div class="question-item">
                        <h4>Вопрос 5: Чем отличаются запросы в управляемом и обычном приложении?</h4>
                        <button class="answer-btn">Показать ответ</button>
                        <div class="answer">
                            В управляемом приложении запросы выполняются преимущественно на сервере с использованием менеджеров объектов, а в обычном приложении возможен клиентский доступ к данным; также различаются способы обработки результатов и интеграции с интерфейсом.
                        </div>
                    </div>
                </div>
                
                <!-- Упражнения для самостоятельной работы -->
                <div class="exercise-list">
                    <h3><i class="fas fa-tasks"></i> Упражнения для самостоятельной работы:</h3>
                    <ol>
                        <li>Создайте отчет "Оборотно-сальдовая ведомость" с помощью СКД</li>
                        <li>Напишите запрос для анализа продаж по периодам</li>
                        <li>Реализуйте отчет с настраиваемыми параметрами</li>
                    </ol>
                    
                    <h4 style="margin-top: 25px; color: #2c3e50;">Пример выполнения (упражнение 2):</h4>
                    <div class="code-example">
                        <span class="code-comment">// Отчет "Анализ продаж"</span><br>
                        <br>
                        <span class="code-comment">&НаСервере</span><br>
                        <span class="code-keyword">Функция</span> СформироватьЗапрос(ПараметрыОтчета)<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос = <span class="code-keyword">Новый Запрос</span>;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.Текст = <span class="code-string">"</span><br>
                        <span class="code-string">    |ВЫБРАТЬ</span><br>
                        <span class="code-string">    |    Продажи.Период КАК Период,</span><br>
                        <span class="code-string">    |    Продажи.Номенклатура КАК Номенклатура,</span><br>
                        <span class="code-string">    |    ВЫРАЗИТЬ(Продажи.Номенклатура.Наименование КАК СТРОКА200) КАК Наименование,</span><br>
                        <span class="code-string">    |    СУММА(Продажи.Количество) КАК Количество,</span><br>
                        <span class="code-string">    |    СУММА(Продажи.Сумма) КАК Сумма,</span><br>
                        <span class="code-string">    |    СУММА(Продажи.Сумма) / СУММА(Продажи.Количество) КАК ЦенаСредняя</span><br>
                        <span class="code-string">    |ИЗ</span><br>
                        <span class="code-string">    |    РегистрНакопления.Продажи КАК Продажи</span><br>
                        <span class="code-string">    |ГДЕ</span><br>
                        <span class="code-string">    |    Продажи.Период МЕЖДУ &НачалоПериода И &КонецПериода</span><br>
                        <span class="code-string">    |СГРУППИРОВАТЬ ПО</span><br>
                        <span class="code-string">    |    Продажи.Период,</span><br>
                        <span class="code-string">    |    Продажи.Номенклатура,</span><br>
                        <span class="code-string">    |    Продажи.Номенклатура.Наименование</span><br>
                        <span class="code-string">    |УПОРЯДОЧИТЬ ПО</span><br>
                        <span class="code-string">    |    Период,</span><br>
                        <span class="code-string">    |    Наименование"</span>;<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.УстановитьПараметр(<span class="code-string">"НачалоПериода"</span>, ПараметрыОтчета.НачалоПериода);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.УстановитьПараметр(<span class="code-string">"КонецПериода"</span>, ПараметрыОтчета.КонецПериода);<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">Возврат</span> Запрос;<br>
                        <br>
                        <span class="code-keyword">КонецФункции</span><br>
                        <br>
                        <span class="code-comment">&НаСервере</span><br>
                        <span class="code-keyword">Процедура</span> СформироватьОтчетНаСервере(ПараметрыОтчета, КомпоновщикНастроек)<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// Устанавливаем параметры отчета</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Настройки = КомпоновщикНастроек.Настройки;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;ЭлементыНастроек = Настройки.Элементы;<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">Для Каждого</span> Элемент <span class="code-keyword">Настроек Из</span> ЭлементыНастроек <span class="code-keyword">Цикл</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;    <span class="code-keyword">Если</span> ЭлементНастроек.Параметр = <span class="code-string">"НачалоПериода"</span> <span class="code-keyword">Тогда</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;        ЭлементНастроек.Значение = ПараметрыОтчета.НачалоПериода;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;    <span class="code-keyword">ИначеЕсли</span> ЭлементНастроек.Параметр = <span class="code-string">"КонецПериода"</span> <span class="code-keyword">Тогда</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;        ЭлементНастроек.Значение = ПараметрыОтчета.КонецПериода;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;    <span class="code-keyword">КонецЕсли</span>;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">КонецЦикла</span>;<br>
                        <br>
                        <span class="code-keyword">КонецПроцедуры</span><br>
                        <br>
                        <span class="code-comment">// Функция для получения итогов по отчету</span><br>
                        <span class="code-keyword">Функция</span> ПолучитьИтогиПоПериоду(НачалоПериода, КонецПериода)<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос = <span class="code-keyword">Новый Запрос</span>;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.Текст = <span class="code-string">"</span><br>
                        <span class="code-string">    |ВЫБРАТЬ</span><br>
                        <span class="code-string">    |    СУММА(Продажи.Количество) КАК КоличествоВсего,</span><br>
                        <span class="code-string">    |    СУММА(Продажи.Сумма) КАК СуммаВсего</span><br>
                        <span class="code-string">    |ИЗ</span><br>
                        <span class="code-string">    |    РегистрНакопления.Продажи КАК Продажи</span><br>
                        <span class="code-string">    |ГДЕ</span><br>
                        <span class="code-string">    |    Продажи.Период МЕЖДУ &НачалоПериода И &КонецПериода"</span>;<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.УстановитьПараметр(<span class="code-string">"НачалоПериода"</span>, НачалоПериода);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Запрос.УстановитьПараметр(<span class="code-string">"КонецПериода"</span>, КонецПериода);<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Результат = Запрос.Выполнить();<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Выборка = Результат.Выбрать();<br>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">Если</span> Выборка.Следующий() <span class="code-keyword">Тогда</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;    <span class="code-keyword">Возврат</span> <span class="code-keyword">Новый Структура</span>(<span class="code-string">"КоличествоВсего, СуммаВсего"</span>, <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;        Выборка.КоличествоВсего, <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;        Выборка.СуммаВсего);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">Иначе</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;    <span class="code-keyword">Возврат</span> <span class="code-keyword">Новый Структура</span>(<span class="code-string">"КоличествоВсего, СуммаВсего"</span>, <span class="code-number">0</span>, <span class="code-number">0</span>);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">КонецЕсли</span>;<br>
                        <br>
                        <span class="code-keyword">КонецФункции</span>
                    </div>
                    
                    <div class="info-box">
                        <p><strong>Подсказка для упражнения 1:</strong> Для оборотно-сальдовой ведомости используйте регистр остатков с измерениями по счетам/субконто, настройте группировку по счетам и периоду, добавьте вычисляемые поля для оборотов и конечных остатков.</p>
                        <p><strong>Подсказка для упражнения 3:</strong> Реализуйте форму настройки параметров отчета с элементами выбора периода, контрагентов и номенклатуры, передавайте эти параметры в СКД через компоновщик настроек.</p>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <a href="section3.html" class="btn">
                    <i class="fas fa-arrow-left"></i> Предыдущий раздел
                </a>
                <a href="../index.html" class="btn">
                    <i class="fas fa-home"></i> К списку разделов
                </a>
                <a href="section5.html" class="btn">
                    Следующий раздел <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>© 2024 Учебный курс. Раздел 4: Отчеты, СКД и запросы</p>
        </div>
    </footer>

    <script src="../script.js"></script>
</body>
</html>
